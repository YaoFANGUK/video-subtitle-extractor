ç®€ä½“ä¸­æ–‡ | [English](README_en.md)

## é¡¹ç›®ç®€ä»‹

![License](https://img.shields.io/badge/License-Apache%202-red.svg)
![python version](https://img.shields.io/badge/Python-3.8+-blue.svg)
![support os](https://img.shields.io/badge/OS-Windows/macOS/Linux-green.svg)

video-subtitle-extractoræ˜¯ä¸€æ¬¾å°†è§†é¢‘ä¸­çš„ç¡¬å­—å¹•æå–ä¸ºå¤–æŒ‚å­—å¹•æ–‡ä»¶(srtæ ¼å¼)çš„è½¯ä»¶ã€‚
ä¸»è¦å®ç°äº†ä»¥ä¸‹åŠŸèƒ½ï¼š

- æå–è§†é¢‘ä¸­çš„å…³é”®å¸§
- æ£€æµ‹è§†é¢‘å¸§ä¸­æ–‡æœ¬çš„æ‰€åœ¨ä½ç½®
- è¯†åˆ«è§†é¢‘å¸§ä¸­æ–‡æœ¬çš„å†…å®¹
- è¿‡æ»¤éå­—å¹•åŒºåŸŸçš„æ–‡æœ¬
- å»é™¤é‡å¤å­—å¹•è¡Œï¼Œå»é™¤æ°´å°(å°æ ‡)æ–‡æœ¬
- ç”Ÿæˆsrtå­—å¹•æ–‡ä»¶
- å¤šè¯­è¨€ï¼šæ”¯æŒ**ä¸­æ–‡/è‹±æ–‡**ã€**ç¹ä½“ä¸­æ–‡**ã€**æ—¥è¯­**ã€**éŸ©è¯­**ã€**æ³•è¯­**ã€**å¾·è¯­**å­—å¹•çš„æå–
- å¤šæ¨¡å¼ï¼š
  - **å¿«é€Ÿ** - å¿«é€Ÿæå–å­—å¹•ä½†å¯èƒ½ä¸¢å­—å¹•
  - **ç²¾å‡†** - ä¸ä¸¢å­—å¹•ä½†é€Ÿåº¦è¾ƒæ…¢

QQäº¤æµç¾¤ï¼š210150985

**ä¸‹è½½åœ°å€**ï¼š

- Windows GPUç‰ˆæœ¬ï¼š
  - å›½å†…ï¼š<a href="https://github.91chi.fun/https://github.com//YaoFANGUK/video-subtitle-extractor/releases/download/0.2.0/vse_windows_GPU.7z">vse_windows_GPU.7z</a>
  - å›½å¤–ï¼š<a href="https://github.com/YaoFANGUK/video-subtitle-extractor/releases/download/0.2.0/vse_windows_GPU.7z">vse_windows_GPU.7z</a>

- Windows CPUç‰ˆæœ¬ï¼š
  - å›½å†…ï¼š<a href=https://github.91chi.fun//https://github.com//YaoFANGUK/video-subtitle-extractor/releases/download/0.2.0/vse_windows_CPU.zip>vse_windows_CPU.zip</a>
  - å›½å¤–ï¼š<a href="https://github.com/YaoFANGUK/video-subtitle-extractor/releases/download/0.2.0/vse_windows_CPU.zip">vse_windows_CPU.zip</a> 

- MacOS CPUç‰ˆæœ¬ï¼š
  - å›½å†…ï¼š<a href="https://github.91chi.fun/https://github.com//YaoFANGUK/video-subtitle-extractor/releases/download/0.1.0/vse_macOS_CPU.dmg">vse_macOS_CPU.dmg</a>
  - å›½å¤–ï¼š<a href="https://github.com/YaoFANGUK/video-subtitle-extractor/releases/download/0.1.0/vse_macOS_CPU.dmg">vse_macOS_CPU.dmg</a> 



## é¡¹ç›®ç‰¹è‰²

- é‡‡ç”¨æœ¬åœ°è¿›è¡ŒOCRè¯†åˆ«ï¼Œæ— éœ€è®¾ç½®è°ƒç”¨ä»»ä½•APIï¼Œä¸éœ€è¦æ¥å…¥ç™¾åº¦ã€é˜¿é‡Œç­‰åœ¨çº¿OCRæœåŠ¡å³å¯æœ¬åœ°å®Œæˆæ–‡æœ¬è¯†åˆ«
- æ”¯æŒGPUåŠ é€Ÿï¼ŒGPUåŠ é€Ÿåå¯ä»¥è·å¾—æ›´é«˜çš„å‡†ç¡®ç‡ä¸æ›´å¿«çš„æå–é€Ÿåº¦
- (CLIç‰ˆæœ¬) æ— éœ€ç”¨æˆ·æ‰‹åŠ¨è®¾ç½®å­—å¹•åŒºåŸŸï¼Œé¡¹ç›®é€šè¿‡æ–‡æœ¬æ£€æµ‹æ¨¡å‹è‡ªåŠ¨æ£€æµ‹å­—å¹•åŒºåŸŸ
- (GUIç‰ˆæœ¬) å›¾å½¢åŒ–ç•Œé¢

<img src="https://z3.ax1x.com/2021/04/09/cNrA1A.png" alt="demo">

ç‚¹å‡»ã€æ‰“å¼€ã€‘åé€‰æ‹©è§†é¢‘æ–‡ä»¶ï¼Œè°ƒæ•´å­—å¹•åŒºåŸŸï¼Œç‚¹å‡»ã€è¿è¡Œã€‘

> **æœ‰ä»»ä½•æ”¹è¿›æ„è§è¯·åœ¨ISSUESä¸­æå‡º**



## æ¼”ç¤º

- GUIç‰ˆï¼š

<p style="text-align:center;"><img src="design/demo.gif" alt="demo.gif"/></p>

- ç‚¹å‡»æŸ¥çœ‹è§†é¢‘æ•™ç¨‹ ğŸ‘‡

[![GPUç‰ˆæœ¬å®‰è£…æ•™ç¨‹](https://z3.ax1x.com/2021/09/08/h7hhNV.png)](https://www.bilibili.com/video/bv11L4y1Y7Tj "GUPç‰ˆæœ¬å®‰è£…æ•™ç¨‹")



## åœ¨çº¿è¿è¡Œ

- ä½¿ç”¨**Google Colab Notebook**(å…è´¹GPU): <a href="https://colab.research.google.com/github/YaoFANGUK/video-subtitle-extractor/blob/main/google_colab.ipynb"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"></a>

> PS: Google Colabåªèƒ½è¿è¡ŒCLIç‰ˆæœ¬



## ä½¿ç”¨è¯´æ˜

#### 1. ä¸‹è½½å®‰è£…Anaconda 

<a href="https://www.anaconda.com/products/individual">https://www.anaconda.com/products/individual#Downloads</a>

#### 2. ä½¿ç”¨condaåˆ›å»ºé¡¹ç›®è™šæ‹Ÿç¯å¢ƒå¹¶æ¿€æ´»ç¯å¢ƒ (å»ºè®®åˆ›å»ºè™šæ‹Ÿç¯å¢ƒè¿è¡Œï¼Œä»¥å…åç»­å‡ºç°é—®é¢˜)

```shell
conda create --name videoEnv python=3.8
```

```shell
conda activate videoEnv  
```

#### 3. å®‰è£…ä¾èµ–æ–‡ä»¶

è¯·ç¡®ä¿ä½ å·²ç»å®‰è£… python 3.8+

- CPUç”¨æˆ· (macç”¨æˆ·) : 

  - å®‰è£…ä¾èµ–ï¼š

    ```shell
    pip install -r requirements.txt
    ```

- GPUç”¨æˆ·(æœ‰Nå¡)ï¼š **è¦è¾¾åˆ°é«˜ç²¾åº¦çš„è¯†åˆ«ç‡è¯·ä½¿ç”¨GPUç‰ˆ**

  - å®‰è£…CUDA 11.2å’ŒcuDNN 8.1.1

    <details>
        <summary>Linuxç”¨æˆ·</summary>
        <h5>(1) ä¸‹è½½CUDA 11.2</h5>
        <pre><code>wget https://developer.download.nvidia.com/compute/cuda/11.2.0/local_installers/cuda_11.2.0_460.27.04_linux.run</code></pre>
        <h5>(2) å®‰è£…CUDA 11.2</h5>
        <pre><code>sudo sh cuda_11.2.0_460.27.04_linux.run --override</code></pre>
        <p>1. è¾“å…¥accept</p>
        <img src="https://z3.ax1x.com/2021/05/24/gv0AVU.png" width="500" alt="">
        <p>2. é€‰ä¸­CUDA Toolkit 11.2ï¼ˆå¦‚æœä½ æ²¡æœ‰å®‰è£…nvidiaé©±åŠ¨åˆ™é€‰ä¸­Driverï¼Œå¦‚æœä½ å·²ç»å®‰è£…äº†nvidiaé©±åŠ¨è¯·ä¸è¦é€‰ä¸­driverï¼‰ï¼Œä¹‹åé€‰ä¸­installï¼Œå›è½¦</p>
        <img src="https://z3.ax1x.com/2021/10/11/5VnwfH.png" width="500" alt="">
        <p>3. æ·»åŠ ç¯å¢ƒå˜é‡</p>
        <p>åœ¨ ~/.bashrc åŠ å…¥ä»¥ä¸‹å†…å®¹</p>
        <pre><code># CUDA
    export PATH=/usr/local/cuda-11.2/bin${PATH:+:${PATH}}
    export LD_LIBRARY_PATH=/usr/local/cuda-11.2/lib64${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}}</code></pre>
        <p>ä½¿å…¶ç”Ÿæ•ˆ</p>
        <pre><code>source ~/.bashrc</code></pre>
        <h5>(3) ä¸‹è½½cuDNN 8.1.1</h5>
        <p>å›½å†…ï¼š<a href="https://github.91chifun.workers.dev/https://github.com//YaoFANGUK/video-subtitle-extractor/releases/download/0.2.0/cudnn-11.2-linux-x64-v8.1.1.33.tgz">cudnn-11.2-linux-x64-v8.1.1.33.tgz</a></p>
        <p>å›½å¤–ï¼š<a href="https://github.com/YaoFANGUK/video-subtitle-extractor/releases/download/0.2.0/cudnn-11.2-linux-x64-v8.1.1.33.tgz">cudnn-11.2-linux-x64-v8.1.1.33.tgz</a></p>
        <h5>(4) å®‰è£…cuDNN 8.1.1</h5>
        <pre><code> tar -zxvf cudnn-11.2-linux-x64-v8.1.1.33.tgz
     sudo cp ./cuda/include/* /usr/local/cuda-11.2/include/
     sudo cp ./cuda/lib64/* /usr/local/cuda-11.2/lib64/
     sudo chmod a+r /usr/local/cuda-11.2/lib64/*
     sudo chmod a+r /usr/local/cuda-11.2/include/*</code></pre>
    </details>
  
    <details>
          <summary>Windowsç”¨æˆ·</summary>
          <h5>(1) ä¸‹è½½CUDA 11.2</h5>
          <a href="https://developer.download.nvidia.com/compute/cuda/11.2.0/local_installers/cuda_11.2.0_460.89_win10.exe">cuda_11.2.0_460.89_win10.exe</a>
          <h5>(2) å®‰è£…CUDA 11.2</h5>
          <h5>(3) ä¸‹è½½cuDNN 8.1.1</h5>
          <p>å›½å†…ï¼š<a href="https://github.91chifun.workers.dev/https://github.com//YaoFANGUK/video-subtitle-extractor/releases/download/0.2.0/cudnn-11.2-windows-x64-v8.1.1.33.zip">cudnn-11.2-windows-x64-v8.1.1.33.zip</a></p>
          <p>å›½å¤–ï¼š<a href="https://github.com/YaoFANGUK/video-subtitle-extractor/releases/download/0.2.0/cudnn-11.2-windows-x64-v8.1.1.33.zip">cudnn-11.2-windows-x64-v8.1.1.33.zip</a></p>
          <h5>(4) å®‰è£…cuDNN 8.1.1</h5>
          <p>
             å°†cuDNNè§£å‹åçš„cudaæ–‡ä»¶å¤¹ä¸­çš„bin, include, libç›®å½•ä¸‹çš„æ–‡ä»¶å¤åˆ¶åˆ°C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v11.2\å¯¹åº”ç›®å½•ä¸‹
          </p>
      </details>

  - å®‰è£…paddlepaddle:

    ```shell
    conda install paddlepaddle-gpu==2.1.3 cudatoolkit=11.2 -c https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/Paddle/ -c conda-forge 
    ```

    > å¦‚æœå®‰è£…cuda 10.2ï¼Œè¯·å¯¹åº”å®‰è£…7.6.5çš„cuDNN, **è¯·ä¸è¦ä½¿ç”¨cuDNN v8.x å’Œ cuda 10.2çš„ç»„åˆ**

  - å®‰è£…å…¶ä»–ä¾èµ–:

    ```shell
    pip install -r requirements_gpu.txt
    ```

#### 4. è¿è¡Œç¨‹åº

- è¿è¡Œå›¾å½¢åŒ–ç•Œé¢ç‰ˆæœ¬(GUI)

```shell
python gui.py
```

- è¿è¡Œå‘½ä»¤è¡Œç‰ˆæœ¬(CLI)

```shell    
python main.py
```



## å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

#### 1. è¿è¡Œä¸æ­£å¸¸/æ²¡æœ‰ç»“æœ

è§£å†³æ–¹æ¡ˆï¼šå¦‚æœä½ ä½¿ç”¨çš„æ˜¯3060/3070/3080ç­‰å®‰åŸ¹æ¶æ„çš„æ˜¾å¡ï¼Œè¯·ä½¿ç”¨æœ€æ–°çš„paddlepaddleç‰ˆæœ¬ä»¥åŠæœ€æ–°çš„cuda 11+


#### 2. CondaHTTPError

è§£å†³æ–¹æ¡ˆï¼š<a href="https://zhuanlan.zhihu.com/p/260034241">https://zhuanlan.zhihu.com/p/260034241</a>

#### 3. Windowsä¸‹å‡ºç°geos_c.dllé”™è¯¯

```text
    _lgeos = CDLL(os.path.join(sys.prefix, 'Library', 'bin', 'geos_c.dll'))
  File "C:\Users\Flavi\anaconda3\envs\subEnv\lib\ctypes\__init__.py", line 364, in __init__
    self._handle = _dlopen(self._name, mode)
OSError: [WinError 126] æ‰¾ä¸åˆ°æŒ‡å®šçš„æ¨¡å—ã€‚
```

è§£å†³æ–¹æ¡ˆï¼š

1) å¸è½½Shapely

```shell
pip uninstall Shapely -y
```

2) ä½¿ç”¨condaé‡æ–°å®‰è£…Shapely

```shell
conda install Shapely             
```
